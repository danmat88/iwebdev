---
import HomeLayout from '../layouts/HomeLayout.astro';
import HomeHero from '../components/home/HomeHero.astro';
import HomeEvents from '../components/home/HomeEvents.astro';
import BackToTop from '../components/common/BackToTop.astro';
import HomePricing from '../components/home/HomePricing.astro'
import HomeFAQ from '../components/home/HomeFAQ.astro';
import HomeContact from '../components/home/HomeContact.astro';
import HomeBenefits from '../components/home/HomeBenefits.astro'
---

<HomeLayout title="Home">
  <main class="home-main">
    <HomeHero />
    <HomeBenefits />
    <HomeEvents />
    <HomePricing />
    <HomeFAQ />
    <HomeContact />
  </main>
  <BackToTop />
</HomeLayout>

<script>
  class EntranceOrchestrator {
    private observer: IntersectionObserver;

    constructor() {
      this.observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');

              if (entry.target.classList.contains('cascade-group')) {
                this.triggerCascade(entry.target as HTMLElement);
              }

              this.observer.unobserve(entry.target);
            }
          });
        },
        {
          threshold: 0.1,
          rootMargin: '-50px 0px -50px 0px'
        }
      );
    }

    private triggerCascade(container: HTMLElement) {
      const children = container.querySelectorAll('.cascade-item');
      children.forEach((child, index) => {
        setTimeout(() => {
          child.classList.add('is-visible');
        }, index * 80); // Stagger delay
      });
    }

    public observe(elements: NodeListOf<Element>) {
      elements.forEach((el) => this.observer.observe(el));
    }

    public observeAll() {
      const entranceElements = document.querySelectorAll(
        '.entrance-fade, .entrance-slide-up, .entrance-scale, ' +
        '.entrance-slide-left, .entrance-slide-right, .cascade-group, ' +
        '.entrance-rotate, .entrance-bounce, .entrance-flip'
      );
      this.observe(entranceElements);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const orchestrator = new EntranceOrchestrator();
    orchestrator.observeAll();

    window.addEventListener('scroll', () => {
      requestAnimationFrame(() => {
        const scrolled = window.scrollY;
        const parallaxElements = document.querySelectorAll('.parallax-bg');

        parallaxElements.forEach((el) => {
          const speed = parseFloat((el as HTMLElement).dataset.speed || '0.5');
          (el as HTMLElement).style.transform = `translateY(${scrolled * speed}px)`;
        });
      });
    });
  });
</script>

<style>
  .home-main {
    position: relative;
    overflow-x: hidden;
  }

  .entrance-fade,
  .entrance-slide-up,
  .entrance-slide-left,
  .entrance-slide-right,
  .entrance-scale,
  .entrance-rotate,
  .entrance-bounce,
  .entrance-flip,
  .cascade-item {
    opacity: 0;
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    transition-delay: var(--delay, 0s);
  }

  .entrance-fade {
    transform: translateY(0);
  }

  .entrance-fade.is-visible {
    opacity: 1;
  }

  .entrance-slide-up {
    transform: translateY(40px);
  }

  .entrance-slide-up.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .entrance-slide-left {
    transform: translateX(-40px);
  }

  .entrance-slide-left.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  .entrance-slide-right {
    transform: translateX(40px);
  }

  .entrance-slide-right.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  .entrance-scale {
    transform: scale(0.9);
  }

  .entrance-scale.is-visible {
    opacity: 1;
    transform: scale(1);
  }

  .entrance-rotate {
    transform: rotate(-5deg) scale(0.95);
  }

  .entrance-rotate.is-visible {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .entrance-bounce {
    transform: translateY(40px);
    transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .entrance-bounce.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .entrance-flip {
    transform: perspective(1000px) rotateX(-15deg);
    transform-origin: center top;
  }

  .entrance-flip.is-visible {
    opacity: 1;
    transform: perspective(1000px) rotateX(0deg);
  }

  .cascade-item {
    transform: translateY(30px);
  }

  .cascade-item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .parallax-bg {
    transition: transform 0.1s ease-out;
  }

  @media (prefers-reduced-motion: reduce) {
    .entrance-fade,
    .entrance-slide-up,
    .entrance-slide-left,
    .entrance-slide-right,
    .entrance-scale,
    .entrance-rotate,
    .entrance-bounce,
    .entrance-flip,
    .cascade-item {
      transition: opacity 0.3s ease;
      transform: none !important;
    }

    .parallax-bg {
      transform: none !important;
    }
  }
</style>