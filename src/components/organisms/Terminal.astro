---
import { heroConfig } from '../../content/pages/home/hero.config';
const { terminal } = heroConfig;
---

<div class="terminal-container">
  <div class="terminal-glow"></div>
  <div class="terminal-window">
    <div class="terminal-border-glow"></div>
    <div class="terminal-inner">
      <div class="terminal-header">
        <div class="terminal-dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <div class="terminal-tabs">
          <span class="tab active">~/your-future</span>
        </div>
        <div class="terminal-actions">
          <span class="terminal-badge">zsh</span>
        </div>
      </div>
      <div class="terminal-body" id="terminal-body">
        <div class="terminal-scanline"></div>
        <div class="terminal-grid-overlay"></div>
      </div>
      <div class="terminal-footer">
        <span class="terminal-status"><span class="status-dot"></span>Ready</span>
        <span class="terminal-info">UTF-8 | LF</span>
      </div>
    </div>
  </div>
  <div class="terminal-reflection" aria-hidden="true">
    <div class="reflection-inner">
      <div class="reflection-body" id="terminal-reflection-body"></div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const body = document.getElementById('terminal-body');
  const reflection = document.getElementById('terminal-reflection-body');
  if (!body) return;

  const icons = {
    diamond: '<svg class="t-icon t-icon-diamond" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41L13.7 2.71a2.41 2.41 0 0 0-3.41 0Z"/></svg>',
    circleEmpty: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>',
    circleFilled: '<svg class="t-icon t-icon-filled" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>',
    loader: '<svg class="t-icon t-icon-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>',
    check: '<svg class="t-icon t-icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
    sparkles: '<svg class="t-icon t-icon-sparkles" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>',
    rocket: '<svg class="t-icon t-icon-rocket" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>',
    users: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
    award: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>',
    globe: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>',
    video: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>',
    chevronRight: '<svg class="t-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>'
  };

  function buildFrames(html) {
    const frames = [];
    const tagStack = [];
    const regex = /(<[^>]+>)|(&[a-zA-Z0-9#]+;)|([^<&])/g;
    let current = '';
    let m;

    while ((m = regex.exec(html)) !== null) {
      if (m[1]) {
        current += m[1];
        if (m[1].startsWith('</')) {
          tagStack.pop();
        } else if (!m[1].endsWith('/>')) {
          const name = m[1].match(/<(\w+)/);
          if (name) tagStack.push(name[1]);
        }
      } else {
        current += m[2] || m[3];
        let closed = current;
        for (let i = tagStack.length - 1; i >= 0; i--) closed += '</' + tagStack[i] + '>';
        frames.push(closed);
      }
    }
    return frames;
  }

  function typeLine(html, speed) {
    return new Promise(resolve => {
      const el = document.createElement('div');
      el.className = 't-line';
      body.appendChild(el);

      if (!html || html.trim() === '') {
        el.innerHTML = '\u00A0';
        body.scrollTop = body.scrollHeight;
        resolve();
        return;
      }

      const frames = buildFrames(html);
      if (frames.length === 0) {
        el.innerHTML = html;
        body.scrollTop = body.scrollHeight;
        resolve();
        return;
      }

      let i = 0;
      function next() {
        if (i >= frames.length) {
          el.innerHTML = html;
          body.scrollTop = body.scrollHeight;
          resolve();
          return;
        }
        el.innerHTML = frames[i++];
        body.scrollTop = body.scrollHeight;
        setTimeout(next, speed);
      }
      next();
    });
  }

  function typeInput(command, speed, showCursor) {
    return new Promise(resolve => {
      const el = document.createElement('div');
      el.className = 't-line input';
      el.innerHTML = '<span class="t-prompt">' + icons.chevronRight + '</span><span class="t-cmd"></span>';
      body.appendChild(el);
      const cmdSpan = el.querySelector('.t-cmd');

      if (!command) {
        if (showCursor) {
          const cur = document.createElement('span');
          cur.className = 't-cursor';
          el.appendChild(cur);
        }
        body.scrollTop = body.scrollHeight;
        resolve();
        return;
      }

      const cur = document.createElement('span');
      cur.className = 't-cursor';
      el.appendChild(cur);

      let i = 0;
      function next() {
        if (i >= command.length) {
          if (!showCursor) cur.remove();
          body.scrollTop = body.scrollHeight;
          resolve();
          return;
        }
        cmdSpan.textContent += command[i++];
        body.scrollTop = body.scrollHeight;
        setTimeout(next, speed);
      }
      next();
    });
  }

  function syncReflection() {
    if (!reflection) return;
    const clone = body.cloneNode(true);
    const sl = clone.querySelector('.terminal-scanline');
    if (sl) sl.remove();
    const grid = clone.querySelector('.terminal-grid-overlay');
    if (grid) grid.remove();
    reflection.innerHTML = clone.innerHTML;
  }

  const wait = ms => new Promise(r => setTimeout(r, ms));

  async function run() {
    const FAST = 8;
    const MED  = 12;
    const CMD  = 14;
    const PAUSE = 50;

    await typeInput('npx create-career@latest', CMD, false);
    syncReflection();
    await wait(PAUSE);

    await typeLine('', 0);

    await typeLine(`<span class="t-cyan">${icons.diamond}</span> <span class="t-bold">Welcome to Career Builder</span> <span class="t-dim">v2.0.1</span>`, MED);
    syncReflection();
    await wait(30);

    await typeLine('', 0);

    await typeLine(`<span class="t-green">${icons.loader}</span> What's your goal?`, MED);
    await wait(20);
    await typeLine(`  <span class="t-option-empty">${icons.circleEmpty}</span> Just browsing`, FAST);
    await typeLine(`  <span class="t-option-empty">${icons.circleEmpty}</span> Learn something new`, FAST);
    await typeLine(`  <span class="t-option-selected">${icons.circleFilled}</span> <span class="t-bold">Transform my career</span>`, FAST);
    syncReflection();
    await wait(PAUSE);

    await typeLine('', 0);

    await typeLine(`<span class="t-dim">${icons.rocket} Creating your personalized path...</span>`, MED);
    syncReflection();
    await wait(PAUSE);

    await typeLine('', 0);

    await typeLine(`<span class="t-success">${icons.check}</span> Unlocked <span class="t-cyan">mentorship</span> access`, FAST);
    await typeLine(`<span class="t-success">${icons.check}</span> Unlocked <span class="t-cyan">certification</span> tracks`, FAST);
    await typeLine(`<span class="t-success">${icons.check}</span> Unlocked <span class="t-cyan">global</span> community`, FAST);
    await typeLine(`<span class="t-success">${icons.check}</span> Unlocked <span class="t-cyan">live</span> workshops`, FAST);
    syncReflection();
    await wait(PAUSE);

    await typeLine('', 0);

    await typeLine(`<span class="t-bold t-green">${icons.sparkles} Success!</span> Your journey begins now.`, MED);
    syncReflection();
    await wait(30);

    await typeInput('', 0, true);
    syncReflection();
  }

  setTimeout(run, 400);
});
</script>

<style>
  .terminal-container {
    --radius-sm: 6px;
    --radius-lg: 14px;
    position: relative;
  }

  .terminal-glow {
    position: absolute;
    inset: -30px;
    background: radial-gradient(ellipse at center, var(--accent-glow), transparent 70%);
    opacity: 0.3;
    z-index: -1;
    animation: glowPulse 4s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes glowPulse {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(1.02); }
  }

  .terminal-window {
    position: relative;
    border-radius: var(--radius-lg);
    padding: 1px;
    transition: all 0.5s ease;
  }

  .terminal-border-glow {
    position: absolute;
    inset: -1px;
    background: linear-gradient(135deg, var(--accent), transparent 50%, var(--accent));
    border-radius: var(--radius-lg);
    opacity: 0.3;
    z-index: -1;
    transition: opacity 0.3s ease;
  }

  .terminal-container:hover .terminal-border-glow {
    opacity: 0.6;
  }

  .terminal-inner {
    position: relative;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow:
      0 20px 50px rgba(var(--black-rgb), 0.4),
      0 0 60px var(--accent-glow),
      inset 0 1px 0 rgba(var(--white-rgb), 0.05);
    z-index: 1;
  }

  .terminal-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border);
  }

  .terminal-dots { display: flex; gap: 6px; }
  .terminal-dots .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    transition: all 0.2s ease;
    cursor: default;
  }
  .terminal-dots .dot:hover {
    transform: scale(1.25);
    filter: brightness(1.3);
  }
  .dot.red { background: var(--terminal-dot-red); box-shadow: 0 0 6px rgba(var(--terminal-dot-red-rgb), 0.4); }
  .dot.yellow { background: var(--terminal-dot-yellow); box-shadow: 0 0 6px rgba(var(--terminal-dot-yellow-rgb), 0.4); }
  .dot.green { background: var(--terminal-dot-green); box-shadow: 0 0 6px rgba(var(--terminal-dot-green-rgb), 0.4); }

  .terminal-tabs { flex: 1; display: flex; justify-content: center; }
  .terminal-tabs .tab {
    padding: 3px 10px;
    background: var(--bg-card);
    border-radius: var(--radius-sm);
    font-size: 10px;
    color: var(--text-secondary);
  }
  .terminal-tabs .tab.active {
    background: var(--bg-tertiary);
    color: var(--text);
  }
  .terminal-badge {
    padding: 2px 7px;
    background: var(--accent);
    border-radius: 4px;
    font-size: 9px;
    font-weight: 700;
    color: var(--black);
    text-transform: uppercase;
  }

  .terminal-body {
    position: relative;
    padding: 14px 18px;
    font-family: var(--font-code);
    font-size: 11px;
    line-height: 1.7;
    min-height: 180px;
    max-height: 180px;
    overflow-y: auto;
    background: linear-gradient(180deg, rgba(var(--black-rgb), 0) 0%, rgba(var(--black-rgb), 0.1) 100%);
  }

  .terminal-body::-webkit-scrollbar { width: 5px; }
  .terminal-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .terminal-scanline {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(var(--cyan-400-rgb), 0.08), transparent);
    animation: scanlineMove 4s linear infinite;
    pointer-events: none;
    z-index: 5;
  }

  @keyframes scanlineMove { 0% { top: 0; } 100% { top: 100%; } }

  .terminal-grid-overlay {
    position: absolute;
    inset: 0;
    background:
      linear-gradient(90deg, rgba(var(--cyan-400-rgb), 0.02) 1px, transparent 1px),
      linear-gradient(rgba(var(--cyan-400-rgb), 0.02) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    opacity: 0.5;
  }

  .terminal-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 14px;
    background: var(--bg-secondary);
    border-top: 1px solid var(--border);
    font-size: 9px;
    color: var(--text-muted);
  }

  .terminal-status { display: flex; align-items: center; gap: 5px; }
  .status-dot {
    width: 5px;
    height: 5px;
    background: var(--green-500-light);
    border-radius: 50%;
    animation: statusPulse 2s ease-in-out infinite;
    box-shadow: 0 0 6px rgba(var(--green-500-light-rgb), 0.5);
  }
  @keyframes statusPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

  .terminal-reflection {
    transform: scaleY(-1) translateY(-1px);
    height: 40px;
    overflow: hidden;
    mask-image: linear-gradient(to bottom, rgba(var(--black-rgb), 0.08) 0%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, rgba(var(--black-rgb), 0.08) 0%, transparent 100%);
    pointer-events: none;
    filter: blur(0.5px);
  }

  .reflection-inner {
    background: rgba(var(--surface-780-rgb), 0.5);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    overflow: hidden;
  }

  .reflection-body {
    padding: 14px 18px;
    font-family: var(--font-code);
    font-size: 11px;
    line-height: 1.7;
    max-height: 180px;
    overflow: hidden;
  }

  .terminal-body :global(.t-line) {
    animation: lineIn 0.2s ease both;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .reflection-body :global(.t-line) { animation: none !important; }
  @keyframes lineIn { from { opacity: 0; transform: translateY(2px); } to { opacity: 1; transform: translateY(0); } }

  .terminal-body :global(.t-line.input),
  .reflection-body :global(.t-line.input) {
    display: flex;
    gap: 8px;
    margin-top: 2px;
  }

  .terminal-body :global(.t-prompt),
  .reflection-body :global(.t-prompt) {
    color: var(--accent);
    font-weight: 700;
    display: flex;
    align-items: center;
  }

  .terminal-body :global(.t-cmd),
  .reflection-body :global(.t-cmd) { color: var(--text); }

  .terminal-body :global(.t-cursor) {
    display: inline-block;
    width: 8px;
    height: 16px;
    background: var(--accent);
    animation: cursorBlink 1s step-end infinite;
    vertical-align: middle;
    margin-left: 2px;
    border-radius: 1px;
    box-shadow: 0 0 8px var(--accent);
  }

  @keyframes cursorBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

  .terminal-body :global(.t-dim), .reflection-body :global(.t-dim) { color: var(--text-muted); }
  .terminal-body :global(.t-cyan), .reflection-body :global(.t-cyan) { color: var(--accent); }
  .terminal-body :global(.t-green), .reflection-body :global(.t-green) { color: var(--green-500-light); }
  .terminal-body :global(.t-bold), .reflection-body :global(.t-bold) { font-weight: 700; color: var(--text); }

  .terminal-body :global(.t-icon),
  .reflection-body :global(.t-icon) {
    width: 14px;
    height: 14px;
    display: inline-block;
    vertical-align: middle;
    flex-shrink: 0;
  }

  .terminal-body :global(.t-icon-diamond),
  .reflection-body :global(.t-icon-diamond) {
    color: var(--accent);
    filter: drop-shadow(0 0 4px var(--accent));
  }

  .terminal-body :global(.t-icon-check),
  .reflection-body :global(.t-icon-check) {
    color: var(--green-500-light);
    filter: drop-shadow(0 0 4px rgba(var(--green-500-light-rgb), 0.5));
    animation: checkPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  @keyframes checkPop {
    0% { transform: scale(0); }
    100% { transform: scale(1); }
  }

  .terminal-body :global(.t-icon-sparkles),
  .reflection-body :global(.t-icon-sparkles) {
    color: var(--yellow-500);
    filter: drop-shadow(0 0 6px rgba(var(--yellow-500-rgb), 0.6));
    animation: sparkle 1s ease-in-out infinite;
  }

  @keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.1) rotate(5deg); }
  }

  .terminal-body :global(.t-icon-rocket),
  .reflection-body :global(.t-icon-rocket) {
    color: var(--text-muted);
    animation: rocketMove 2s ease-in-out infinite;
  }

  @keyframes rocketMove {
    0%, 100% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(2px) translateY(-1px); }
  }

  .terminal-body :global(.t-icon-spin),
  .reflection-body :global(.t-icon-spin) {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .terminal-body :global(.t-icon-filled),
  .reflection-body :global(.t-icon-filled) {
    color: var(--accent);
    filter: drop-shadow(0 0 4px var(--accent));
  }

  .terminal-body :global(.t-option-empty),
  .reflection-body :global(.t-option-empty) {
    color: var(--text-muted);
    opacity: 0.5;
  }

  .terminal-body :global(.t-option-selected),
  .reflection-body :global(.t-option-selected) {
    color: var(--accent);
  }

  .terminal-body :global(.t-success),
  .reflection-body :global(.t-success) {
    color: var(--green-500-light);
  }

  @media (max-width: 768px) {
    .terminal-body {
      min-height: 160px;
      max-height: 160px;
      font-size: 10px;
      padding: 12px 14px;
    }
    .terminal-reflection { display: none; }
    .terminal-glow { display: none; }
  }

  :global([data-theme="daylight"]) .terminal-inner {
    box-shadow:
      0 20px 50px rgba(var(--black-rgb), 0.15),
      0 0 40px rgba(var(--info-rgb), 0.1);
  }

  :global([data-theme="daylight"]) .terminal-glow {
    opacity: 0.15;
  }

  :global([data-theme="daylight"]) .terminal-border-glow {
    opacity: 0.2;
  }

  :global([data-theme="daylight"]) .terminal-grid-overlay {
    opacity: 0.3;
  }
</style>